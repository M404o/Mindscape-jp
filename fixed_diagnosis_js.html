// é‡ã„åˆ†æå‡¦ç†ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰
        async function processHeavyAnalysis(assessmentData) {
            console.log('ğŸ§  é‡ã„åˆ†æå‡¦ç†é–‹å§‹ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰...');
            
            try {
                // ğŸ†• ç›¸å¯¾ãƒ‘ã‚¹ã«ä¿®æ­£ï¼
                const response = await fetch('/api/process-assessment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(assessmentData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('âœ… é‡ã„åˆ†æå®Œäº†:', result);
                    
                    // ä¼æ¥­å´ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
                    saveToEnterpriseDatabase(result);
                    
                    // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰é€šçŸ¥
                    notifyDashboard(result);
                    
                    return { status: 'success', type: 'heavy_analysis', data: result };
                } else {
                    console.log('âš ï¸ é‡ã„åˆ†æAPIå¿œç­”ã‚¨ãƒ©ãƒ¼:', response.status);
                    return { status: 'error', type: 'heavy_analysis', error: 'API_ERROR' };
                }
                
            } catch (error) {
                console.error('âŒ é‡ã„åˆ†æã‚¨ãƒ©ãƒ¼:', error);
                return { status: 'error', type: 'heavy_analysis', error: error.message };
            }
        }

        // Midjourneyç”»åƒç”Ÿæˆï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰
        async function generateMidjourneyImage(assessmentData) {
            console.log('ğŸ¨ Midjourneyç”»åƒç”Ÿæˆé–‹å§‹ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰...');
            
            try {
                const midjourneyRequest = {
                    heart_landscape: assessmentData.heart_landscape,
                    user_name: assessmentData.profile.name,
                    session_id: assessmentData.session_id
                };

                // ğŸ†• ç›¸å¯¾ãƒ‘ã‚¹ã«ä¿®æ­£ï¼
                const response = await fetch('/api/generate-image', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(midjourneyRequest)
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('âœ… Midjourneyé€ä¿¡å®Œäº†:', result);
                    return { status: 'success', type: 'image_generation', data: result };
                } else {
                    console.log('âš ï¸ Midjourney APIå¿œç­”ã‚¨ãƒ©ãƒ¼:', response.status);
                    return { status: 'error', type: 'image_generation', error: 'API_ERROR' };
                }

            } catch (error) {
                console.error('âŒ Midjourneyé€£æºã‚¨ãƒ©ãƒ¼:', error);
                return { status: 'error', type: 'image_generation', error: error.message };
            }
        }

        // ã‚»ãƒ‘ãƒ¬ãƒ¼ãƒˆå¼æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showSeparateSuccess(sessionId) {
            const container = document.querySelector('.container');
            
            const successHTML = `
                <div class="glass-card" id="separateSuccess">
                    <div class="separate-status">
                        <h3>ğŸ‰ ã‚»ãƒ‘ãƒ¬ãƒ¼ãƒˆå¼å‡¦ç†å®Œäº†ï¼</h3>
                        <p>è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ã®åŒæ™‚å‡¦ç†ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸã€‚<span class="processing-indicator"></span></p>
                    </div>
                    
                    <div class="step-badge">Processing Complete</div>
                    <h2 class="title">ã‚»ãƒ‘ãƒ¬ãƒ¼ãƒˆå¼ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒä¸­</h2>
                    <p class="subtitle">
                        ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ã‚ãªãŸã®è¨ºæ–­ãŒå®Œäº†ã—ã€ã‚»ãƒ‘ãƒ¬ãƒ¼ãƒˆå¼ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã£ã¦ä»¥ä¸‹ã®å‡¦ç†ãŒåŒæ™‚å®Ÿè¡Œã•ã‚Œã¾ã—ãŸã€‚
                    </p>
                    
                    <div style="display: grid; gap: 1rem; margin: 2rem 0;">
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 1.5rem; border-radius: 16px; border-left: 4px solid #10b981;">
                            <h4 style="color: #059669; margin-bottom: 0.5rem;">âœ… è»½ã„çµæœæº–å‚™å®Œäº†</h4>
                            <p style="color: #374151;">ã‚ãªãŸå°‚ç”¨ã®ç¾ã—ã„çµæœç”»é¢ã‚’æº–å‚™ã—ã¾ã—ãŸ</p>
                        </div>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 1.5rem; border-radius: 16px; border-left: 4px solid #3b82f6;">
                            <h4 style="color: #1d4ed8; margin-bottom: 0.5rem;">ğŸ§  é‡ã„åˆ†æå‡¦ç†ä¸­</h4>
                            <p style="color: #374151;">ä¼æ¥­å‘ã‘è©³ç´°åˆ†æã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œä¸­</p>
                        </div>
                        
                        <div style="background: rgba(236, 72, 153, 0.1); padding: 1.5rem; border-radius: 16px; border-left: 4px solid #ec4899;">
                            <h4 style="color: #be185d; margin-bottom: 0.5rem;">ğŸ¨ ç”»åƒç”Ÿæˆé–‹å§‹</h4>
                            <p style="color: #374151;">å¿ƒè±¡é¢¨æ™¯ã‚¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ã®ç”Ÿæˆã‚’é–‹å§‹ã—ã¾ã—ãŸ</p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin: 2rem 0; padding: 1.5rem; background: rgba(255, 255, 255, 0.4); border-radius: 16px;">
                        <h4 style="color: #2d3748; margin-bottom: 0.5rem;">ã‚»ãƒƒã‚·ãƒ§ãƒ³ID</h4>
                        <code style="background: rgba(0,0,0,0.1); padding: 0.5rem 1rem; border-radius: 8px; font-family: monospace;">${sessionId}</code>
                    </div>
                    
                    <div class="nav-buttons">
                        <button class="glass-button btn-next" onclick="window.location.href='/light_results.html'">
                            ğŸŒ¸ è»½ã„çµæœã‚’è¦‹ã‚‹ â†’
                        </button>
                    </div>
                </div>
            `;
            
            container.innerHTML = successHTML;
        }

        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showErrorMessage() {
            const container = document.querySelector('.container');
            
            const errorHTML = `
                <div class="glass-card">
                    <div class="step-badge" style="background: linear-gradient(135deg, #ef4444, #dc2626);">Error</div>
                    <h2 class="title">å‡¦ç†ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h2>
                    <p class="subtitle">ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚è¨ºæ–­å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</p>
                    
                    <div style="background: rgba(239, 68, 68, 0.1); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: 16px; padding: 1.5rem; margin: 2rem 0;">
                        <h4 style="color: #dc2626; margin-bottom: 0.5rem;">ğŸš¨ ã‚¨ãƒ©ãƒ¼è©³ç´°</h4>
                        <p style="color: #374151;">ã‚»ãƒ‘ãƒ¬ãƒ¼ãƒˆå¼ã‚·ã‚¹ãƒ†ãƒ ã®ä¸€éƒ¨ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</p>
                    </div>
                    
                    <div class="nav-buttons">
                        <button class="glass-button btn-back" onclick="location.reload()">
                            ğŸ”„ è¨ºæ–­ã‚’ã‚„ã‚Šç›´ã™
                        </button>
                        <button class="glass-button btn-next" onclick="window.location.href='/light_results.html'">
                            ğŸŒ¸ è»½ã„çµæœã‚’è©¦ã™
                        </button>
                    </div>
                </div>
            `;
            
            container.innerHTML = errorHTML;
        }

        // è»½ã„çµæœ + é‡ã„çµæœã¸ã®æ¡ˆå†…ã‚’è¿½åŠ 
        function showCompletionOptions() {
            const container = document.querySelector('.container');
            
            const optionsHTML = `
                <div class="glass-card">
                    <div class="step-badge">è¨ºæ–­å®Œäº†</div>
                    <h2 class="title">ã‚»ãƒ‘ãƒ¬ãƒ¼ãƒˆå¼å‡¦ç†å®Œäº†</h2>
                    <p class="subtitle">è¨ºæ–­ãŒå®Œäº†ã—ã¾ã—ãŸã€‚çµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
                    
                    <div class="nav-buttons">
                        <button class="glass-button btn-next" onclick="window.location.href='/light_results.html'">
                            ğŸŒ¸ è»½ã„çµæœã‚’è¦‹ã‚‹
                        </button>
                        <button class="glass-button btn-back" onclick="window.location.href='/analysis.html'">
                            ğŸ“Š é‡ã„åˆ†æçµæœ
                        </button>
                    </div>
                </div>
            `;
            
            container.innerHTML = optionsHTML;
        }